<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <title>📋 Admin - Kateqoriya İdarəetməsi</title>
</head>
<body>
    <h1>📋 Kateqoriya İdarəetməsi</h1>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <ul class="flashes" style="list-style: none; padding: 0;">
            {% for category, message in messages %}
                <li style="border: 1px solid {% if category == 'error' %}red{% elif category == 'warning' %}orange{% else %}green{% endif %}; padding: 10px; margin-bottom: 10px;">
                    {{ message }}
                </li>
            {% endfor %}
            </ul>
        {% endif %}
    {% endwith %}

    <div style="margin-bottom: 20px;">
        <a href="{{ url_for('admin_panel') }}">🛠️ Ölkə İdarəetməsi</a> | 
        <a href="{{ url_for('content_panel') }}">⚙️ Kontent İdarəetməsi</a> | <a href="{{ url_for('logout') }}">🚪 Çıxış</a>
    </div>

    <hr>

    <h2>1. Yeni Kateqoriya Əlavə Et</h2>
    <form method="POST" action="{{ url_for('category_panel') }}">
        <label for="category_name">Kateqoriya Adı:</label>
        <input type="text" id="category_name" name="category_name" required>
        <button type="submit">Əlavə Et</button>
    </form>

    <hr>

    <h2>2. Ölkəyə Kateqoriya Təyin Et</h2>
    {% if countries and categories %}
        <form method="POST" action="{{ url_for('assign_category') }}">
            <label for="country_id">Ölkə Seç:</label>
            <select name="country_id" id="country_id" required>
                {% for country in countries %}
                    <option value="{{ country.id }}">{{ country.name }} ({{ country.code }})</option>
                {% endfor %}
            </select>
            
            <label for="category_id">Kateqoriya Seç:</label>
            <select name="category_id" id="category_id" required>
                {% for category in categories %}
                    <option value="{{ category.id }}">{{ category.name }}</option>
                {% endfor %}
            </select>
            
            <button type="submit">Təyin Et</button>
        </form>
    {% else %}
        <p style="color: red;">Zəhmət olmasa, əvvəlcə ölkə və kateqoriya əlavə edin.</p>
    {% endif %}

    <hr>

    <h2>3. Mövcud Kateqoriyalar</h2>
    <ul>
    {% for category in categories %}
        <li style="margin-bottom: 10px;">
            **{{ category.name }}** (ID: {{ category.id }})
            
            <form method="POST" action="{{ url_for('delete_category', category_id=category.id) }}" style="display: inline-block; margin-left: 15px;">
                <button type="submit" onclick="return confirm('Bu kateqoriya silinəcək. Əminsinizmi?')" style="background-color: darkred; color: white; border: none; padding: 3px 8px; cursor: pointer; font-size: 12px;">
                    Sil
                </button>
            </form>
            
            <br>
            *Əlaqəli Ölkələr:* {% if category.countries %}
                {{ category.countries | map(attribute='name') | join(', ') }}
            {% else %}
                *(Yoxdur)*
            {% endif %}
        </li>
    {% else %}
        <li>Hələ heç bir kateqoriya əlavə edilməyib.</li>
    {% endfor %}
    </ul>
</body>
</html>